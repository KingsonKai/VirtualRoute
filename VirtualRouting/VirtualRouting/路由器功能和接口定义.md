## 路由器功能和接口定义

#### 功能

首先界定路由表的功能如下

1. 接收数据包并且回应，回应的意思就是返回一条响应给发送端

   可以举例如下： A发送数据包给B，A此时等待接收B可能发过来的消息。B接收包后，发送响应responseMessage给A，A收到后，输出到界面上，到时候调试的时候才可以看到是否接收成功。

   再比如，收到心跳侦测包等等包的时候，必须回应给发送端一个消息表明自己还存活着。

   这里有一个例外，发送路由信息时，无需等待回响。路由信息只要发出去就发出去了，不用有回响信息。

2. 发送心跳侦测包和路由信息

   过程如下：

   * 发送包，等待接收响应（心跳侦测包）
   * 对于路由信息，发送完就不用管。
   * 心跳侦测包还必须等待接收响应，如果没有响应说明主机已经down掉，此时要更新路由表的信息，调用相应的函数。同时，更新路由表完毕后，还要发送路由信息给邻居或者给其他所有主机（区分LS和DV）

3. 解析数据包信息

   路由器会收到三种形式的数据报文

   * 普通的数据报文
   * 路由信息报文
   * 心跳侦测包

   每个报文格式如下：

   | 第0位       | 1-15位 | 17-31位 | 33-最后一位 |
   | --------- | ----- | ------ | ------- |
   | type，报文类型 | 源IP地址 | 目的IP地址 | 数据信息    |

   IP地址、数据信息之间有'*'隔开，比如说

   ```
   0192.168.111.111*192.168.111.112*what are you doing?
   ```

   注意，每个IP地址都是15位，不足15位的用0补全。

   ```
   1192.168.111.111*192.168.001.002*192.168.111.00210*192.168.111.00305*
   ```

   * 类型1是路由信息报文，路由信息报文的数据部分有所不同。（前面格式相同，就是数据部分有规定）

   格式一般如下：

   | 目的IP地址 | 开销          | 以*符号隔开不同的路由信息 |
   | ------ | ----------- | ------------- |
   | 15位    | 2位（0-99的数值） | 1位            |

```
192.168.111.00210 代表到目的网咯192.168.111.002的开销是10
```

​	路由信息发完是不需要等待接收”我已经收到“这类信息的	



* 类型2是心跳侦测包

  ```
  2192.168.111.111*192.168.111.112*Are you alive?
  ```

  比较简单，其实我们只要检测到type=2，且目的主机是自己，那么就返回一个信息“I am alive!"

### 重点和关键点

1. 收到数据包后，首先检查是否是传给自己的数据包，如果不是传给自己的，那么要做转发操作
2. 收到心跳侦测包回响和路由表信息后，若有更新，一定要调用对应算法。并且看下是否需要返回给源主机一些信息
3. 收到路由表信息后，提取出字符串里的路由信息，解析后，要根据RoutertableLS或者DV做相应的操作（解析后如何使得数据传过去更新RouterTable呢？），以使得算法能高效方便的运行。



我在controller（其实就相当于一服务器）里面定义了handlePacket（有好几种）函数，根据这些函数实现功能。（如果有需要修改也可以修改，毕竟不一定是合适的API）